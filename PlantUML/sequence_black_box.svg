<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2453px" preserveAspectRatio="none" style="width:885px;height:2453px;background:#FFFFFF;" version="1.1" viewBox="0 0 885 2453" width="885px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cc1zinjl6fxs" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="90.4741" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="164"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="408.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="352.274"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="104.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="863.4742"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="208.8001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="997.4742"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="45.2" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1235.8743"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="163.6001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1310.6744"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="192.2001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1653.4746"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="238.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1918.8747"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="120.0001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="2230.4748"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="131.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="657" y="381.8741"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="756.5" y="893.0742"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="756.5" y="1755.2746"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="847.5" y="1072.2743"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="847.5" y="1340.2744"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="847.5" y="2068.4748"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="462.6001" style="stroke:#000000;stroke-width:2.0;" width="701" x="10" y="313.074"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="164.2" style="stroke:#000000;stroke-width:2.0;" width="681" x="20" y="604.4741"/><rect fill="#FFFFFF" height="44.7999" style="stroke:none;stroke-width:1.0;" width="681" x="20" y="723.8742"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="52" x2="52" y1="88.7999" y2="2368.4749"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="301.5" x2="301.5" y1="88.7999" y2="2368.4749"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="662" x2="662" y1="88.7999" y2="2368.4749"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="761" x2="761" y1="88.7999" y2="2368.4749"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="852" x2="852" y1="88.7999" y2="2368.4749"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="30" y="85.0059">User1</text><ellipse cx="52" cy="15" fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M52,23 L52,50 M39,31 L65,31 M52,50 L39,65 M52,50 L65,65 " fill="none" filter="url(#f1cc1zinjl6fxs)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="30" y="2380.4809">User1</text><ellipse cx="52" cy="2394.2748" fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M52,2402.2748 L52,2429.2748 M39,2410.2748 L65,2410.2748 M52,2429.2748 L39,2444.2748 M52,2429.2748 L65,2444.2748 " fill="none" filter="url(#f1cc1zinjl6fxs)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="85" x="257.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="264.5" y="73.0059">Chat Agent</text><rect fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="85" x="257.5" y="2367.4749"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="264.5" y="2387.4809">Chat Agent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="633" y="85.0059">Network</text><ellipse cx="662" cy="15" fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M662,23 L662,50 M649,31 L675,31 M662,50 L649,65 M662,50 L675,65 " fill="none" filter="url(#f1cc1zinjl6fxs)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="633" y="2380.4809">Network</text><ellipse cx="662" cy="2394.2748" fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M662,2402.2748 L662,2429.2748 M649,2410.2748 L675,2410.2748 M662,2429.2748 L649,2444.2748 M662,2429.2748 L675,2444.2748 " fill="none" filter="url(#f1cc1zinjl6fxs)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="701" y="85.0059">Remote Database</text><ellipse cx="761.5" cy="15" fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M761.5,23 L761.5,50 M748.5,31 L774.5,31 M761.5,50 L748.5,65 M761.5,50 L774.5,65 " fill="none" filter="url(#f1cc1zinjl6fxs)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="701" y="2380.4809">Remote Database</text><ellipse cx="761.5" cy="2394.2748" fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M761.5,2402.2748 L761.5,2429.2748 M748.5,2410.2748 L774.5,2410.2748 M761.5,2429.2748 L748.5,2444.2748 M761.5,2429.2748 L774.5,2444.2748 " fill="none" filter="url(#f1cc1zinjl6fxs)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="832" y="85.0059">Clock</text><ellipse cx="852.5" cy="15" fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M852.5,23 L852.5,50 M839.5,31 L865.5,31 M852.5,50 L839.5,65 M852.5,50 L865.5,65 " fill="none" filter="url(#f1cc1zinjl6fxs)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="832" y="2380.4809">Clock</text><ellipse cx="852.5" cy="2394.2748" fill="#FEFECE" filter="url(#f1cc1zinjl6fxs)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M852.5,2402.2748 L852.5,2429.2748 M839.5,2410.2748 L865.5,2410.2748 M852.5,2429.2748 L839.5,2444.2748 M852.5,2429.2748 L865.5,2444.2748 " fill="none" filter="url(#f1cc1zinjl6fxs)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="90.4741" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="164"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="408.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="352.274"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="104.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="863.4742"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="208.8001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="997.4742"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="45.2" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1235.8743"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="163.6001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1310.6744"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="192.2001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1653.4746"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="238.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1918.8747"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="120.0001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="2230.4748"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="131.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="657" y="381.8741"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="756.5" y="893.0742"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="756.5" y="1755.2746"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="847.5" y="1072.2743"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="847.5" y="1340.2744"/><rect fill="#FFFFFF" filter="url(#f1cc1zinjl6fxs)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="847.5" y="2068.4748"/><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="878" x="0" y="119.5999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="119.5999" y2="119.5999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="122.5999" y2="122.5999"/><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="156" x="361" y="108.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138" x="367" y="124.8769">User1 opens the agent</text><polygon fill="#A80036" points="285,160,295,164,285,168,289,164" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="164" y2="164"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="59" y="158.477">Opens Agent</text><rect fill="#FBFB77" filter="url(#f1cc1zinjl6fxs)" height="35" style="stroke:#A80036;stroke-width:1.0;" width="204" x="200" y="177"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="196" x="204" y="192.167">bool isUsernameValid = False</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="175" x="204" y="205.804">UserList user_list = null</text><polygon fill="#A80036" points="63,250.474,53,254.474,63,258.474,59,254.474" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="254.474" y2="254.474"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="233.351">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="69" y="248.951">Username Input</text><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="878" x="0" y="283.274"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="283.274" y2="283.274"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="286.274" y2="286.274"/><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="95" x="391.5" y="272.474"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="397.5" y="288.551">Login phase</text><path d="M10,313.074 L83,313.074 L83,320.074 L73,330.074 L10,330.074 L10,313.074 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="462.6001" style="stroke:#000000;stroke-width:2.0;" width="701" x="10" y="313.074"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="326.151">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110" x="98" y="325.2929">[if !isUsernameValid]</text><polygon fill="#A80036" points="285,348.274,295,352.274,285,356.274,289,352.274" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="352.274" y2="352.274"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="59" y="346.751">Logins as "name"</text><polygon fill="#A80036" points="645,377.8741,655,381.8741,645,385.8741,649,381.8741" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="651" y1="381.8741" y2="381.8741"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="314" y="376.3511">UDPBroadcast_IDRequest()</text><polygon fill="#A80036" points="318,407.4741,308,411.4741,318,415.4741,314,411.4741" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="656" y1="411.4741" y2="411.4741"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="324" y="405.9511">[from UPD packet] {User2_name, User2_IP, User2_port}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="349" y1="441.0741" y2="441.0741"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="349" y1="441.0741" y2="454.0741"/><line style="stroke:#A80036;stroke-width:1.0;" x1="308" x2="349" y1="454.0741" y2="454.0741"/><polygon fill="#A80036" points="318,450.0741,308,454.0741,318,458.0741,314,454.0741" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="314" y="435.5511">user_list.append({User2_name, User2_IP, User2_port})</text><polygon fill="#A80036" points="318,479.6741,308,483.6741,318,487.6741,314,483.6741" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="656" y1="483.6741" y2="483.6741"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="20" x="324" y="478.1511">. . .</text><polygon fill="#A80036" points="318,509.2741,308,513.2741,318,517.2741,314,513.2741" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="661" y1="513.2741" y2="513.2741"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="324" y="507.7511">[from UPD packet] {UserN_ID, UserN_IP, UserN_port}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="349" y1="542.8741" y2="542.8741"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="349" y1="542.8741" y2="555.8741"/><line style="stroke:#A80036;stroke-width:1.0;" x1="308" x2="349" y1="555.8741" y2="555.8741"/><polygon fill="#A80036" points="318,551.8741,308,555.8741,318,559.8741,314,555.8741" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="323" x="314" y="537.3511">user_list.append({UserN_name, UserN_IP, UserN_port})</text><rect fill="#FBFB77" filter="url(#f1cc1zinjl6fxs)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="250" x="177" y="568.8741"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="181" y="584.9511">isUsernameValid = !user_list.find("name")</text><path d="M20,604.4741 L80,604.4741 L80,611.4741 L70,621.4741 L20,621.4741 L20,604.4741 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="164.2" style="stroke:#000000;stroke-width:2.0;" width="681" x="20" y="604.4741"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="35" y="617.5512">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="139" x="95" y="616.6931">[isUsernameValid == false]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="349" y1="643.6742" y2="643.6742"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="349" y1="643.6742" y2="656.6742"/><line style="stroke:#A80036;stroke-width:1.0;" x1="308" x2="349" y1="656.6742" y2="656.6742"/><polygon fill="#A80036" points="318,652.6742,308,656.6742,318,660.6742,314,656.6742" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="314" y="638.1512">isUsernameValid = True</text><polygon fill="#A80036" points="63,682.2742,53,686.2742,63,690.2742,59,686.2742" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="296" y1="686.2742" y2="686.2742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="69" y="680.7512">Shows Connected User List</text><polygon fill="#A80036" points="650,711.8742,660,715.8742,650,719.8742,654,715.8742" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="715.8742" y2="715.8742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="314" y="710.3512">UDPBroadcast_NotifyConnection("name")</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="701" y1="724.8742" y2="724.8742"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="135" x="25" y="735.0931">[isUsernameValid == true]</text><polygon fill="#A80036" points="63,756.6741,53,760.6741,63,764.6741,59,760.6741" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="760.6741" y2="760.6741"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="69" y="755.1511">Shows invalid input message</text><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="878" x="0" y="803.4741"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="803.4741" y2="803.4741"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="806.4741" y2="806.4741"/><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="284" x="297" y="792.6741"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="266" x="303" y="808.7511">User1 wants to chat with (connected) User2</text><polygon fill="#A80036" points="285,859.4742,295,863.4742,285,867.4742,289,863.4742" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="863.4742" y2="863.4742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="59" y="842.3511">Starts Chatting Session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="59" y="857.9512">with User2</text><polygon fill="#A80036" points="744.5,889.0742,754.5,893.0742,744.5,897.0742,748.5,893.0742" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="750.5" y1="893.0742" y2="893.0742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="314" y="887.5512">retrieveHistory(User2)</text><polygon fill="#A80036" points="318,918.6742,308,922.6742,318,926.6742,314,922.6742" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="760.5" y1="922.6742" y2="922.6742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="324" y="917.1512">history_user2</text><polygon fill="#A80036" points="63,963.8742,53,967.8742,63,971.8742,59,967.8742" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="967.8742" y2="967.8742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="946.7512">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="69" y="962.3512">Chat window with conversation history</text><polygon fill="#A80036" points="285,993.4742,295,997.4742,285,1001.4742,289,997.4742" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="997.4742" y2="997.4742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="59" y="991.9512">Sends Message "Hi!" M1</text><polygon fill="#A80036" points="650,1038.6743,660,1042.6743,650,1046.6743,654,1042.6743" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="1042.6743" y2="1042.6743"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="314" y="1021.5512">Request (TCP) connection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="314" y="1037.1512">with User2</text><polygon fill="#A80036" points="835.5,1068.2743,845.5,1072.2743,835.5,1076.2743,839.5,1072.2743" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="841.5" y1="1072.2743" y2="1072.2743"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="314" y="1066.7513">getTime()</text><polygon fill="#A80036" points="318,1097.8743,308,1101.8743,318,1105.8743,314,1101.8743" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="851.5" y1="1101.8743" y2="1101.8743"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="324" y="1096.3513">current_time</text><polygon fill="#A80036" points="650,1127.4743,660,1131.4743,650,1135.4743,654,1131.4743" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="1131.4743" y2="1131.4743"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="314" y="1125.9513">sendMessage(User2,M1)</text><polygon fill="#A80036" points="749.5,1157.0743,759.5,1161.0743,749.5,1165.0743,753.5,1161.0743" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="755.5" y1="1161.0743" y2="1161.0743"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="314" y="1155.5513">updateHistory(User2,M1)</text><polygon fill="#A80036" points="63,1202.2743,53,1206.2743,63,1210.2743,59,1206.2743" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="1206.2743" y2="1206.2743"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="1185.1513">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="73" y="1200.7513">Updated chat with new message</text><polygon fill="#A80036" points="318,1231.8743,308,1235.8743,318,1239.8743,314,1235.8743" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="661" y1="1235.8743" y2="1235.8743"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="324" y="1230.3513">Receive Messsage "Hello" M2</text><polygon fill="#A80036" points="63,1277.0744,53,1281.0744,63,1285.0744,59,1281.0744" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="1281.0744" y2="1281.0744"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="1259.9514">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="73" y="1275.5514">Updated chat with new message</text><polygon fill="#A80036" points="285,1306.6744,295,1310.6744,285,1314.6744,289,1310.6744" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="1310.6744" y2="1310.6744"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="59" y="1305.1514">Sends Message "See you later!" M3</text><polygon fill="#A80036" points="835.5,1336.2744,845.5,1340.2744,835.5,1344.2744,839.5,1340.2744" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="841.5" y1="1340.2744" y2="1340.2744"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="314" y="1334.7514">getTime()</text><polygon fill="#A80036" points="318,1365.8744,308,1369.8744,318,1373.8744,314,1369.8744" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="851.5" y1="1369.8744" y2="1369.8744"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="324" y="1364.3514">current_time</text><polygon fill="#A80036" points="650,1395.4744,660,1399.4744,650,1403.4744,654,1399.4744" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="1399.4744" y2="1399.4744"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="314" y="1393.9514">sendMessage(User2,M3)</text><polygon fill="#A80036" points="749.5,1425.0744,759.5,1429.0744,749.5,1433.0744,753.5,1429.0744" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="755.5" y1="1429.0744" y2="1429.0744"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="314" y="1423.5514">updateHistory(User2,M3)</text><polygon fill="#A80036" points="63,1470.2745,53,1474.2745,63,1478.2745,59,1474.2745" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="1474.2745" y2="1474.2745"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="1453.1515">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="73" y="1468.7515">Updated chat with new message</text><polygon fill="#A80036" points="290,1499.8745,300,1503.8745,290,1507.8745,294,1503.8745" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="296" y1="1503.8745" y2="1503.8745"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="59" y="1498.3515">Closes Chatting Session</text><polygon fill="#A80036" points="650,1560.6745,660,1564.6745,650,1568.6745,654,1564.6745" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="302" x2="656" y1="1564.6745" y2="1564.6745"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="309" y="1527.9515">End (TCP) connection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="309" y="1543.5515">with User2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="309" y="1559.1515">Close chat UI</text><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="878" x="0" y="1593.4745"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="1593.4745" y2="1593.4745"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="1596.4745" y2="1596.4745"/><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="250" x="314" y="1582.6745"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="232" x="320" y="1598.7515">User1 receives a message from User3</text><polygon fill="#A80036" points="318,1649.4746,308,1653.4746,318,1657.4746,314,1653.4746" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="661" y1="1653.4746" y2="1653.4746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="324" y="1632.3516">Incoming TCP connection request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="324" y="1647.9516">from User3</text><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="349" y1="1683.0746" y2="1683.0746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="349" y1="1683.0746" y2="1696.0746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="308" x2="349" y1="1696.0746" y2="1696.0746"/><polygon fill="#A80036" points="318,1692.0746,308,1696.0746,318,1700.0746,314,1696.0746" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="314" y="1677.5516">Start Chatting Session with User3</text><polygon fill="#A80036" points="318,1721.6746,308,1725.6746,318,1729.6746,314,1725.6746" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="661" y1="1725.6746" y2="1725.6746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="324" y="1720.1516">Receive Messsage M4 from User3</text><polygon fill="#A80036" points="744.5,1751.2746,754.5,1755.2746,744.5,1759.2746,748.5,1755.2746" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="750.5" y1="1755.2746" y2="1755.2746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="314" y="1749.7516">retrieveHistory(User3)</text><polygon fill="#A80036" points="318,1780.8746,308,1784.8746,318,1788.8746,314,1784.8746" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="760.5" y1="1784.8746" y2="1784.8746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="324" y="1779.3516">history_user3</text><polygon fill="#A80036" points="63,1841.6747,53,1845.6747,63,1849.6747,59,1845.6747" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="1845.6747" y2="1845.6747"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="1808.9516">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="73" y="1824.5516">Updated chat</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="69" y="1840.1517">with history and new message</text><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="878" x="0" y="1874.4747"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="1874.4747" y2="1874.4747"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="1877.4747" y2="1877.4747"/><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="183" x="347.5" y="1863.6747"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165" x="353.5" y="1879.7517">User1 sends a file to User3</text><polygon fill="#A80036" points="285,1914.8747,295,1918.8747,285,1922.8747,289,1918.8747" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="1918.8747" y2="1918.8747"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="59" y="1913.3517">Sends File F1</text><polygon fill="#A80036" points="650,1960.0747,660,1964.0747,650,1968.0747,654,1964.0747" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="1964.0747" y2="1964.0747"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="314" y="1942.9517">FTPRequest(User3)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="314" y="1958.5517">to User3</text><polygon fill="#A80036" points="318,2005.2747,308,2009.2747,318,2013.2747,314,2009.2747" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="661" y1="2009.2747" y2="2009.2747"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="324" y="1988.1517">FTPAccept()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="324" y="2003.7517">from User3</text><polygon fill="#A80036" points="650,2034.8748,660,2038.8748,650,2042.8748,654,2038.8748" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="2038.8748" y2="2038.8748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="314" y="2033.3518">FTPSendFile(User3,F1)</text><polygon fill="#A80036" points="835.5,2064.4748,845.5,2068.4748,835.5,2072.4748,839.5,2068.4748" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="841.5" y1="2068.4748" y2="2068.4748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="314" y="2062.9518">getTime()</text><polygon fill="#A80036" points="318,2094.0748,308,2098.0748,318,2102.0748,314,2098.0748" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="851.5" y1="2098.0748" y2="2098.0748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="324" y="2092.5518">current_time</text><polygon fill="#A80036" points="650,2123.6748,660,2127.6748,650,2131.6748,654,2127.6748" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="2127.6748" y2="2127.6748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="314" y="2122.1518">sendMessage(User3,M4))</text><polygon fill="#A80036" points="749.5,2153.2748,759.5,2157.2748,749.5,2161.2748,753.5,2157.2748" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="302" x2="755.5" y1="2157.2748" y2="2157.2748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="309" y="2151.7518">updateHistory(User3,M4)</text><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="878" x="0" y="2186.0748"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="2186.0748" y2="2186.0748"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="878" y1="2189.0748" y2="2189.0748"/><rect fill="#EEEEEE" filter="url(#f1cc1zinjl6fxs)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="158" x="360" y="2175.2748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="140" x="366" y="2191.3518">User1 closes the agent</text><polygon fill="#A80036" points="285,2226.4748,295,2230.4748,285,2234.4748,289,2230.4748" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="2230.4748" y2="2230.4748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="59" y="2224.9518">Closes Agent</text><polygon fill="#A80036" points="650,2271.6749,660,2275.6749,650,2279.6749,654,2275.6749" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="2275.6749" y2="2275.6749"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="314" y="2254.5519">End (TCP) connection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="314" y="2270.1519">with User3</text><polygon fill="#A80036" points="650,2316.8749,660,2320.8749,650,2324.8749,654,2320.8749" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="656" y1="2320.8749" y2="2320.8749"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="314" y="2299.7519">(UDP)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="314" y="2315.3519">notifyUsers()</text><polygon fill="#A80036" points="63,2346.4749,53,2350.4749,63,2354.4749,59,2350.4749" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="2350.4749" y2="2350.4749"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="69" y="2344.9519">Closes UI</text><!--MD5=[ae34edfb748c83cb7386053525d62499]
@startuml sequence_black_box
actor User1 as User
participant "Chat Agent" as chatAgent
actor "Network" as Network
actor "Remote Database" as db
actor "Clock" as Clock

== User1 opens the agent ==

User -> chatAgent ++ : Opens Agent
 rnote over chatAgent: ""bool isUsernameValid = False""\n""UserList user_list = null""
chatAgent -> User - - : Shows UI :\nUsername Input

== Login phase ==

loop if !isUsernameValid
User -> chatAgent ++ : Logins as "name"

chatAgent -> Network ++ : UDPBroadcast_IDRequest()
Network -> chatAgent : [from UPD packet] {User2_name, User2_IP, User2_port} 
chatAgent -> chatAgent : user_list.append({User2_name, User2_IP, User2_port})
Network -> chatAgent : . . . 
Network -> chatAgent - - : [from UPD packet] {UserN_ID, UserN_IP, UserN_port}
chatAgent -> chatAgent : user_list.append({UserN_name, UserN_IP, UserN_port})
rnote over chatAgent:  isUsernameValid = !user_list.find("name")

alt isUsernameValid == false
chatAgent -> chatAgent : isUsernameValid = True
User <- chatAgent : Shows Connected User List
chatAgent -> Network : UDPBroadcast_NotifyConnection("name")
    else isUsernameValid == true
User <- chatAgent - - : Shows invalid input message
    end
end

== User1 wants to chat with (connected) User2 ==

User -> chatAgent ++ : Starts Chatting Session\nwith User2
  chatAgent -> db ++ : retrieveHistory(User2)
  db -> chatAgent - - : history_user2
chatAgent -> User - - : Shows UI :\nChat window with conversation history

User -> chatAgent ++ : Sends Message "Hi!" M1 
  chatAgent -> Network : Request (TCP) connection\nwith User2
  chatAgent -> Clock ++ : getTime()
  Clock -> chatAgent - - : current_time
  chatAgent -> Network : sendMessage(User2,M1)
  chatAgent -> db : updateHistory(User2,M1)
chatAgent -> User - - : Shows UI :\n Updated chat with new message

Network -> chatAgent ++ : Receive Messsage "Hello" M2 
chatAgent -> User - - : Shows UI :\n Updated chat with new message

User -> chatAgent ++ : Sends Message "See you later!" M3 
  chatAgent -> Clock ++ : getTime()
  Clock -> chatAgent - - : current_time
  chatAgent -> Network : sendMessage(User2,M3)
  chatAgent -> db : updateHistory(User2,M3)
chatAgent -> User - - : Shows UI :\n Updated chat with new message

User -> chatAgent : Closes Chatting Session
chatAgent -> Network : End (TCP) connection\nwith User2\nClose chat UI

== User1 receives a message from User3 ==

Network -> chatAgent ++ : Incoming TCP connection request\nfrom User3
chatAgent -> chatAgent : Start Chatting Session with User3
Network -> chatAgent : Receive Messsage M4 from User3

  chatAgent -> db ++ : retrieveHistory(User3) 
  db -> chatAgent - - : history_user3
chatAgent -> User - - : Shows UI :\n Updated chat\nwith history and new message

== User1 sends a file to User3 ==
User -> chatAgent ++ : Sends File F1
chatAgent -> Network : FTPRequest(User3)\nto User3
Network -> chatAgent : FTPAccept()\nfrom User3
chatAgent -> Network : FTPSendFile(User3,F1)
chatAgent -> Clock ++ : getTime()
Clock -> chatAgent - - : current_time
chatAgent -> Network : sendMessage(User3,M4))
chatAgent -> db - - : updateHistory(User3,M4)
== User1 closes the agent ==

User -> chatAgent ++ : Closes Agent
  chatAgent -> Network : End (TCP) connection\nwith User3
  chatAgent -> Network : (UDP)\nnotifyUsers()
chatAgent -> User - - : Closes UI

@enduml

PlantUML version 1.2021.14(Fri Nov 12 17:46:50 CET 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>