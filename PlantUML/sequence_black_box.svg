<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2175px" preserveAspectRatio="none" style="width:862px;height:2175px;background:#FFFFFF;" version="1.1" viewBox="0 0 862 2175" width="862px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rhbel2nzy45g" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="103.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="180.7999"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="261.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="382"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="104.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="746.4"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="208.8001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="880.4001"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="45.2" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1118.8002"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="192.2001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1343.2004"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="254.0001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1608.6005"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="120.0001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1935.8006"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="576" y="427.2"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="729" y="776.0001"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="729" y="1445.0004"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="824.5" y="955.2002"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="824.5" y="1758.2006"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="315.8001" style="stroke:#000000;stroke-width:2.0;" width="669" x="10" y="342.7999"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="179.8" style="stroke:#000000;stroke-width:2.0;" width="649" x="20" y="471.8"/><rect fill="#FFFFFF" height="44.7999" style="stroke:none;stroke-width:1.0;" width="649" x="20" y="606.8001"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="52" x2="52" y1="105.5999" y2="2073.8007"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="301.5" x2="301.5" y1="105.5999" y2="2073.8007"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="581" x2="581" y1="105.5999" y2="2073.8007"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="734" x2="734" y1="105.5999" y2="2073.8007"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="829" x2="829" y1="105.5999" y2="2073.8007"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="30" y="101.8059">User1</text><ellipse cx="52" cy="31.7999" fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M52,39.7999 L52,66.7999 M39,47.7999 L65,47.7999 M52,66.7999 L39,81.7999 M52,66.7999 L65,81.7999 " fill="none" filter="url(#f1rhbel2nzy45g)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="30" y="2085.8067">User1</text><ellipse cx="52" cy="2099.6006" fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M52,2107.6006 L52,2134.6006 M39,2115.6006 L65,2115.6006 M52,2134.6006 L39,2149.6006 M52,2134.6006 L65,2149.6006 " fill="none" filter="url(#f1rhbel2nzy45g)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="85" x="257.5" y="69.7999"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="264.5" y="89.8059">Chat Agent</text><rect fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="85" x="257.5" y="2072.8007"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="264.5" y="2092.8067">Chat Agent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="552" y="85.0059">Network</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="503" y="101.8059">(User2,User3,...,UserN)</text><ellipse cx="581" cy="15" fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M581,23 L581,50 M568,31 L594,31 M581,50 L568,65 M581,50 L594,65 " fill="none" filter="url(#f1rhbel2nzy45g)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="552" y="2085.8067">Network</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="503" y="2102.6066">(User2,User3,...,UserN)</text><ellipse cx="581" cy="2116.4006" fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M581,2124.4006 L581,2151.4006 M568,2132.4006 L594,2132.4006 M581,2151.4006 L568,2166.4006 M581,2151.4006 L594,2166.4006 " fill="none" filter="url(#f1rhbel2nzy45g)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="673.5" y="85.0059">Remote Database</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124" x="669" y="101.8059">(User*User*History)</text><ellipse cx="734" cy="15" fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M734,23 L734,50 M721,31 L747,31 M734,50 L721,65 M734,50 L747,65 " fill="none" filter="url(#f1rhbel2nzy45g)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="673.5" y="2085.8067">Remote Database</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124" x="669" y="2102.6066">(User*User*History)</text><ellipse cx="734" cy="2116.4006" fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M734,2124.4006 L734,2151.4006 M721,2132.4006 L747,2132.4006 M734,2151.4006 L721,2166.4006 M734,2151.4006 L747,2166.4006 " fill="none" filter="url(#f1rhbel2nzy45g)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="809" y="101.8059">Clock</text><ellipse cx="829.5" cy="31.7999" fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M829.5,39.7999 L829.5,66.7999 M816.5,47.7999 L842.5,47.7999 M829.5,66.7999 L816.5,81.7999 M829.5,66.7999 L842.5,81.7999 " fill="none" filter="url(#f1rhbel2nzy45g)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="809" y="2085.8067">Clock</text><ellipse cx="829.5" cy="2099.6006" fill="#FEFECE" filter="url(#f1rhbel2nzy45g)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M829.5,2107.6006 L829.5,2134.6006 M816.5,2115.6006 L842.5,2115.6006 M829.5,2134.6006 L816.5,2149.6006 M829.5,2134.6006 L842.5,2149.6006 " fill="none" filter="url(#f1rhbel2nzy45g)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="103.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="180.7999"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="261.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="382"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="104.4001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="746.4"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="208.8001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="880.4001"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="45.2" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1118.8002"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="192.2001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1343.2004"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="254.0001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1608.6005"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="120.0001" style="stroke:#A80036;stroke-width:1.0;" width="10" x="297" y="1935.8006"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="576" y="427.2"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="729" y="776.0001"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="729" y="1445.0004"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="824.5" y="955.2002"/><rect fill="#FFFFFF" filter="url(#f1rhbel2nzy45g)" height="29.6" style="stroke:#A80036;stroke-width:1.0;" width="10" x="824.5" y="1758.2006"/><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="855" x="0" y="136.3999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="136.3999" y2="136.3999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="139.3999" y2="139.3999"/><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="156" x="349.5" y="125.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138" x="355.5" y="141.6769">User1 opens the agent</text><polygon fill="#A80036" points="285,176.7999,295,180.7999,285,184.7999,289,180.7999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="180.7999" y2="180.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="59" y="175.2769">Opens Agent</text><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="349" y1="225.9999" y2="225.9999"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="349" y1="225.9999" y2="238.9999"/><line style="stroke:#A80036;stroke-width:1.0;" x1="308" x2="349" y1="238.9999" y2="238.9999"/><polygon fill="#A80036" points="318,234.9999,308,238.9999,318,242.9999,314,238.9999" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="314" y="204.8769">isUsernameValid = False</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="314" y="220.4769">user_list = null</text><polygon fill="#A80036" points="63,280.1999,53,284.1999,63,288.1999,59,284.1999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="284.1999" y2="284.1999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="263.0769">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="69" y="278.6769">Username Input</text><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="855" x="0" y="312.9999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="312.9999" y2="312.9999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="315.9999" y2="315.9999"/><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="95" x="380" y="302.1999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="77" x="386" y="318.2769">Login phase</text><path d="M10,342.7999 L83,342.7999 L83,349.7999 L73,359.7999 L10,359.7999 L10,342.7999 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="315.8001" style="stroke:#000000;stroke-width:2.0;" width="669" x="10" y="342.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="25" y="355.877">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110" x="98" y="355.0189">[if !isUsernameValid]</text><polygon fill="#A80036" points="285,378,295,382,285,386,289,382" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="382" y2="382"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="59" y="376.477">Logins as "name"</text><polygon fill="#A80036" points="564,423.2,574,427.2,564,431.2,568,427.2" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="570" y1="427.2" y2="427.2"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="314" y="406.077">(UDP)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="314" y="421.677">verifyUnicity()</text><polygon fill="#A80036" points="318,452.8,308,456.8,318,460.8,314,456.8" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="580" y1="456.8" y2="456.8"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="324" y="451.277">user_list</text><path d="M20,471.8 L80,471.8 L80,478.8 L70,488.8 L20,488.8 L20,471.8 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="179.8" style="stroke:#000000;stroke-width:2.0;" width="649" x="20" y="471.8"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="35" y="484.877">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="167" x="95" y="484.0189">[user_list.find("name") == false]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="349" y1="511" y2="511"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="349" y1="511" y2="524"/><line style="stroke:#A80036;stroke-width:1.0;" x1="308" x2="349" y1="524" y2="524"/><polygon fill="#A80036" points="318,520,308,524,318,528,314,524" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="314" y="505.477">isUsernameValid = True</text><polygon fill="#A80036" points="63,549.6001,53,553.6001,63,557.6001,59,553.6001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="296" y1="553.6001" y2="553.6001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="69" y="548.0771">Shows Connected User List</text><polygon fill="#A80036" points="569,594.8001,579,598.8001,569,602.8001,573,598.8001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="575" y1="598.8001" y2="598.8001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="314" y="577.6771">(UDP)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="314" y="593.2771">notifyConnection("name")</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="669" y1="607.8001" y2="607.8001"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="163" x="25" y="618.019">[user_list.find("name") == true]</text><polygon fill="#A80036" points="63,639.6,53,643.6,63,647.6,59,643.6" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="643.6" y2="643.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="69" y="638.077">Shows invalid input message</text><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="855" x="0" y="686.4"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="686.4" y2="686.4"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="689.4" y2="689.4"/><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="284" x="285.5" y="675.6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="266" x="291.5" y="691.677">User1 wants to chat with (connected) User2</text><polygon fill="#A80036" points="285,742.4,295,746.4,285,750.4,289,746.4" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="746.4" y2="746.4"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="59" y="725.277">Starts Chatting Session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="59" y="740.877">with User2</text><polygon fill="#A80036" points="717,772.0001,727,776.0001,717,780.0001,721,776.0001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="723" y1="776.0001" y2="776.0001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="314" y="770.4771">retrieveHistory(User2)</text><polygon fill="#A80036" points="318,801.6001,308,805.6001,318,809.6001,314,805.6001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="733" y1="805.6001" y2="805.6001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="324" y="800.0771">history_user2</text><polygon fill="#A80036" points="63,846.8001,53,850.8001,63,854.8001,59,850.8001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="850.8001" y2="850.8001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="829.6771">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="69" y="845.2771">Chat window with conversation history</text><polygon fill="#A80036" points="285,876.4001,295,880.4001,285,884.4001,289,880.4001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="880.4001" y2="880.4001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="59" y="874.8771">Sends Message M1</text><polygon fill="#A80036" points="569,921.6001,579,925.6001,569,929.6001,573,925.6001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="575" y1="925.6001" y2="925.6001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="314" y="904.4771">Request (TCP) connection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="314" y="920.0771">with User2</text><polygon fill="#A80036" points="812.5,951.2002,822.5,955.2002,812.5,959.2002,816.5,955.2002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="818.5" y1="955.2002" y2="955.2002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="314" y="949.6772">getTime()</text><polygon fill="#A80036" points="318,980.8002,308,984.8002,318,988.8002,314,984.8002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="828.5" y1="984.8002" y2="984.8002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="324" y="979.2772">current_time</text><polygon fill="#A80036" points="569,1010.4002,579,1014.4002,569,1018.4002,573,1014.4002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="575" y1="1014.4002" y2="1014.4002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="314" y="1008.8772">sendMessage(User2,M1)</text><polygon fill="#A80036" points="722,1040.0002,732,1044.0002,722,1048.0002,726,1044.0002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="728" y1="1044.0002" y2="1044.0002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="314" y="1038.4772">updateHistory(User2,M1)</text><polygon fill="#A80036" points="63,1085.2002,53,1089.2002,63,1093.2002,59,1089.2002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="1089.2002" y2="1089.2002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="1068.0772">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="73" y="1083.6772">Updated chat with new message</text><polygon fill="#A80036" points="318,1114.8002,308,1118.8002,318,1122.8002,314,1118.8002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="580" y1="1118.8002" y2="1118.8002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="324" y="1113.2772">Receive Messsage M2</text><polygon fill="#A80036" points="63,1160.0003,53,1164.0003,63,1168.0003,59,1164.0003" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="1164.0003" y2="1164.0003"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="1142.8772">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="73" y="1158.4773">Updated chat with new message</text><polygon fill="#A80036" points="290,1189.6003,300,1193.6003,290,1197.6003,294,1193.6003" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="296" y1="1193.6003" y2="1193.6003"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="59" y="1188.0773">Closes Chatting Session</text><polygon fill="#A80036" points="569,1250.4003,579,1254.4003,569,1258.4003,573,1254.4003" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="302" x2="575" y1="1254.4003" y2="1254.4003"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="309" y="1217.6773">End (TCP) connection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="309" y="1233.2773">with User2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="309" y="1248.8773">Close chat UI</text><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="855" x="0" y="1283.2003"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="1283.2003" y2="1283.2003"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="1286.2003" y2="1286.2003"/><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="250" x="302.5" y="1272.4003"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="232" x="308.5" y="1288.4773">User1 receives a message from User3</text><polygon fill="#A80036" points="318,1339.2004,308,1343.2004,318,1347.2004,314,1343.2004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="580" y1="1343.2004" y2="1343.2004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="324" y="1322.0773">Incoming TCP connection request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="324" y="1337.6774">from User3</text><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="349" y1="1372.8004" y2="1372.8004"/><line style="stroke:#A80036;stroke-width:1.0;" x1="349" x2="349" y1="1372.8004" y2="1385.8004"/><line style="stroke:#A80036;stroke-width:1.0;" x1="308" x2="349" y1="1385.8004" y2="1385.8004"/><polygon fill="#A80036" points="318,1381.8004,308,1385.8004,318,1389.8004,314,1385.8004" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="314" y="1367.2774">Start Chatting Session with User3</text><polygon fill="#A80036" points="318,1411.4004,308,1415.4004,318,1419.4004,314,1415.4004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="580" y1="1415.4004" y2="1415.4004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="324" y="1409.8774">Receive Messsage M3 from User3</text><polygon fill="#A80036" points="717,1441.0004,727,1445.0004,717,1449.0004,721,1445.0004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="723" y1="1445.0004" y2="1445.0004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="314" y="1439.4774">retrieveHistory(User3)</text><polygon fill="#A80036" points="318,1470.6004,308,1474.6004,318,1478.6004,314,1474.6004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="733" y1="1474.6004" y2="1474.6004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="324" y="1469.0774">history_user3</text><polygon fill="#A80036" points="63,1531.4005,53,1535.4005,63,1539.4005,59,1535.4005" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="1535.4005" y2="1535.4005"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="69" y="1498.6774">Shows UI :</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="73" y="1514.2774">Updated chat</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="69" y="1529.8775">with history and new message</text><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="855" x="0" y="1564.2005"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="1564.2005" y2="1564.2005"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="1567.2005" y2="1567.2005"/><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="183" x="336" y="1553.4005"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165" x="342" y="1569.4775">User1 sends a file to User3</text><polygon fill="#A80036" points="285,1604.6005,295,1608.6005,285,1612.6005,289,1608.6005" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="1608.6005" y2="1608.6005"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="59" y="1603.0775">Sends File F1</text><polygon fill="#A80036" points="569,1649.8005,579,1653.8005,569,1657.8005,573,1653.8005" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="575" y1="1653.8005" y2="1653.8005"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="314" y="1632.6775">File transfert request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="314" y="1648.2775">to User3</text><polygon fill="#A80036" points="318,1695.0005,308,1699.0005,318,1703.0005,314,1699.0005" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="580" y1="1699.0005" y2="1699.0005"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="324" y="1677.8775">File transfert accept</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="324" y="1693.4775">from User3</text><polygon fill="#A80036" points="569,1724.6006,579,1728.6006,569,1732.6006,573,1728.6006" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="575" y1="1728.6006" y2="1728.6006"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="314" y="1723.0775">sendFile(User3,F1)</text><polygon fill="#A80036" points="812.5,1754.2006,822.5,1758.2006,812.5,1762.2006,816.5,1758.2006" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="818.5" y1="1758.2006" y2="1758.2006"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="314" y="1752.6776">getTime()</text><polygon fill="#A80036" points="318,1783.8006,308,1787.8006,318,1791.8006,314,1787.8006" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="828.5" y1="1787.8006" y2="1787.8006"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="324" y="1782.2776">current_time</text><polygon fill="#A80036" points="569,1829.0006,579,1833.0006,569,1837.0006,573,1833.0006" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="575" y1="1833.0006" y2="1833.0006"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="314" y="1811.8776">sendMessage(User3,M4)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="314" y="1827.4776">(M4 is file name, size and date it was sent)</text><polygon fill="#A80036" points="722,1858.6006,732,1862.6006,722,1866.6006,726,1862.6006" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="302" x2="728" y1="1862.6006" y2="1862.6006"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="309" y="1857.0776">updateHistory(User3,M4)</text><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="855" x="0" y="1891.4006"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="1891.4006" y2="1891.4006"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="855" y1="1894.4006" y2="1894.4006"/><rect fill="#EEEEEE" filter="url(#f1rhbel2nzy45g)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="158" x="348.5" y="1880.6006"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="140" x="354.5" y="1896.6776">User1 closes the agent</text><polygon fill="#A80036" points="285,1931.8006,295,1935.8006,285,1939.8006,289,1935.8006" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="52" x2="291" y1="1935.8006" y2="1935.8006"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="59" y="1930.2776">Closes Agent</text><polygon fill="#A80036" points="569,1977.0007,579,1981.0007,569,1985.0007,573,1981.0007" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="575" y1="1981.0007" y2="1981.0007"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="314" y="1959.8777">End (TCP) connection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="314" y="1975.4777">with User3</text><polygon fill="#A80036" points="569,2022.2007,579,2026.2007,569,2030.2007,573,2026.2007" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="307" x2="575" y1="2026.2007" y2="2026.2007"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="314" y="2005.0777">(UDP)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="314" y="2020.6777">notifyUsers()</text><polygon fill="#A80036" points="63,2051.8007,53,2055.8007,63,2059.8007,59,2055.8007" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="57" x2="301" y1="2055.8007" y2="2055.8007"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="69" y="2050.2777">Closes UI</text><!--MD5=[dd8fff3678862edb8cd9d0cd30165501]
@startuml sequence_black_box
actor User1 as User
participant "Chat Agent" as chatAgent
actor "Network\n(User2,User3,...,UserN)" as Network
actor "Remote Database\n(User*User*History)" as db
actor "Clock" as Clock

== User1 opens the agent ==

User -> chatAgent ++ : Opens Agent
  chatAgent -> chatAgent : isUsernameValid = False\nuser_list = null
chatAgent -> User - - : Shows UI :\nUsername Input

== Login phase ==

loop if !isUsernameValid
User -> chatAgent ++ : Logins as "name"

chatAgent -> Network ++ : (UDP)\nverifyUnicity()
Network -> chatAgent - - : user_list
 
alt user_list.find("name") == false
chatAgent -> chatAgent : isUsernameValid = True
User <- chatAgent : Shows Connected User List
chatAgent -> Network : (UDP)\nnotifyConnection("name")
    else user_list.find("name") == true
User <- chatAgent - - : Shows invalid input message
    end
end

== User1 wants to chat with (connected) User2 ==

User -> chatAgent ++ : Starts Chatting Session\nwith User2
  chatAgent -> db ++ : retrieveHistory(User2)
  db -> chatAgent - - : history_user2
chatAgent -> User - - : Shows UI :\nChat window with conversation history

User -> chatAgent ++ : Sends Message M1
  chatAgent -> Network : Request (TCP) connection\nwith User2
  chatAgent -> Clock ++ : getTime()
  Clock -> chatAgent - - : current_time
  chatAgent -> Network : sendMessage(User2,M1)
  chatAgent -> db : updateHistory(User2,M1)
chatAgent -> User - - : Shows UI :\n Updated chat with new message

Network -> chatAgent ++ : Receive Messsage M2
chatAgent -> User - - : Shows UI :\n Updated chat with new message

User -> chatAgent : Closes Chatting Session
chatAgent -> Network : End (TCP) connection\nwith User2\nClose chat UI

== User1 receives a message from User3 ==

Network -> chatAgent ++ : Incoming TCP connection request\nfrom User3
chatAgent -> chatAgent : Start Chatting Session with User3
Network -> chatAgent : Receive Messsage M3 from User3

  chatAgent -> db ++ : retrieveHistory(User3) 
  db -> chatAgent - - : history_user3
chatAgent -> User - - : Shows UI :\n Updated chat\nwith history and new message

== User1 sends a file to User3 ==
User -> chatAgent ++ : Sends File F1
chatAgent -> Network : File transfert request\nto User3
Network -> chatAgent : File transfert accept\nfrom User3
chatAgent -> Network : sendFile(User3,F1)
chatAgent -> Clock ++ : getTime()
Clock -> chatAgent - - : current_time
chatAgent -> Network : sendMessage(User3,M4)\n(M4 is file name, size and date it was sent)
chatAgent -> db - - : updateHistory(User3,M4)
== User1 closes the agent ==

User -> chatAgent ++ : Closes Agent
  chatAgent -> Network : End (TCP) connection\nwith User3
  chatAgent -> Network : (UDP)\nnotifyUsers()
chatAgent -> User - - : Closes UI

@enduml

PlantUML version 1.2021.14(Fri Nov 12 17:46:50 CET 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>